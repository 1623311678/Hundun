/* @source cursor @line_count 578 @branch master */

import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';

<Meta 
  title="Hundun/Vue/æ¼”åŒ–è¿›ç¨‹" 
  parameters={{
    docs: {
      description: {
        component: 'Vueæ¡†æ¶ä»2.0åˆ°3.6+çš„å®Œæ•´æ¼”åŒ–è¿›ç¨‹åˆ†æï¼ŒåŒ…æ‹¬å„ç‰ˆæœ¬ç‰¹æ€§ã€æ€§èƒ½å¯¹æ¯”ã€æŠ€æœ¯çªç ´å’Œæœªæ¥è¶‹åŠ¿ã€‚'
      }
    }
  }}
/>

# Vue æ¼”åŒ–è¿›ç¨‹è¯¦è§£


## Vue 2.x æ—¶ä»£ (2016-2022)

### Vue 2.0 (2016å¹´9æœˆ)
**æ ¸å¿ƒç‰¹æ€§ï¼š**
- å¼•å…¥è™šæ‹ŸDOMï¼Œæå‡æ¸²æŸ“æ€§èƒ½
- æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“(SSR)
- å¼•å…¥å“åº”å¼ç³»ç»Ÿ
- ç»„ä»¶åŒ–å¼€å‘
- å•æ–‡ä»¶ç»„ä»¶(.vue)
- Vue Router 2.0
- Vuex çŠ¶æ€ç®¡ç†

**æŠ€æœ¯æ¶æ„ï¼š**
```javascript
// Vue 2.0 ç»„ä»¶å†™æ³•
export default {
  data() {
    return {
      message: 'Hello Vue 2.0'
    }
  },
  methods: {
    handleClick() {
      this.message = 'Updated'
    }
  }
}
```

### Vue 2.6 (2019å¹´2æœˆ)
**é‡è¦æ›´æ–°ï¼š**
- æ–°å¢ `v-slot` æŒ‡ä»¤ï¼Œç»Ÿä¸€æ’æ§½è¯­æ³•
- æ–°å¢ `v-memo` æŒ‡ä»¤ï¼Œä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“æ€§èƒ½
- æ–°å¢ `v-once` æŒ‡ä»¤çš„æ”¹è¿›
- æ–°å¢ `$listeners` å¯¹è±¡
- æ–°å¢ `$scopedSlots` å¯¹è±¡
- æ–°å¢ `$attrs` å¯¹è±¡

**æ’æ§½è¯­æ³•ç»Ÿä¸€ï¼š**
```vue
<!-- æ—§è¯­æ³• -->
<template slot="header" slot-scope="props">
  {{ props.text }}
</template>

<!-- æ–°è¯­æ³• -->
<template v-slot:header="props">
  {{ props.text }}
</template>
```

### Vue 2.7 (2022å¹´7æœˆ)
**Vue 3 ç‰¹æ€§å›è¿ï¼š**
- æ”¯æŒ Composition API
- æ”¯æŒ `<script setup>` è¯­æ³•
- æ”¯æŒ `defineProps`ã€`defineEmits`ã€`defineExpose`
- æ”¯æŒ CSS v-bind
- æ”¯æŒ `v-memo` æŒ‡ä»¤
- æ”¯æŒ `v-bind` çš„ `.camel` ä¿®é¥°ç¬¦
- æ”¯æŒ `v-on` çš„ `.vnode` ä¿®é¥°ç¬¦

**Composition API ç¤ºä¾‹ï¼š**
```vue
<script setup>
import { ref, computed } from 'vue'

const count = ref(0)
const doubleCount = computed(() => count.value * 2)

const increment = () => {
  count.value++
}
</script>
```

## Vue 3.x æ—¶ä»£ (2020-è‡³ä»Š)

### Vue 3.0 (2020å¹´9æœˆ)
**é©å‘½æ€§æ›´æ–°ï¼š**

#### 1. æ€§èƒ½æå‡
- åŸºäº Proxy çš„å“åº”å¼ç³»ç»Ÿ
- ç¼–è¯‘æ—¶ä¼˜åŒ–
- Tree-shaking æ”¯æŒ
- æ›´å°çš„åŒ…ä½“ç§¯

#### 2. Composition API
```javascript
import { ref, reactive, computed, watch, onMounted } from 'vue'

export default {
  setup() {
    const count = ref(0)
    const state = reactive({
      name: 'Vue 3',
      version: '3.0'
    })
    
    const doubleCount = computed(() => count.value * 2)
    
    watch(count, (newVal, oldVal) => {
      console.log(`Count changed from ${oldVal} to ${newVal}`)
    })
    
    onMounted(() => {
      console.log('Component mounted')
    })
    
    return {
      count,
      state,
      doubleCount
    }
  }
}
```

#### 3. æ–°ç‰¹æ€§
- Teleport ç»„ä»¶
- Fragments (å¤šæ ¹èŠ‚ç‚¹)
- Suspense ç»„ä»¶
- å…¨å±€ API é‡æ„
- TypeScript æ”¯æŒå¢å¼º

#### 4. ç¼–è¯‘ä¼˜åŒ–
```vue
<!-- é™æ€æå‡ -->
<div>
  <span>é™æ€å†…å®¹</span>
  <span>{{ dynamic }}</span>
</div>

<!-- ç¼–è¯‘å -->
const _hoisted_1 = createVNode("span", null, "é™æ€å†…å®¹")

export function render() {
  return createVNode("div", null, [
    _hoisted_1, // é™æ€èŠ‚ç‚¹è¢«æå‡
    createVNode("span", null, ctx.dynamic)
  ])
}
```

### Vue 3.2 (2021å¹´8æœˆ)
**é‡è¦æ›´æ–°ï¼š**
- `<script setup>` è¯­æ³•ç³–ç¨³å®šç‰ˆ
- `defineProps`ã€`defineEmits`ã€`defineExpose` ç¼–è¯‘å™¨å®
- `v-memo` æŒ‡ä»¤
- CSS v-bind
- æ€§èƒ½ä¼˜åŒ–

**`<script setup>` å®Œæ•´ç¤ºä¾‹ï¼š**
```vue
<script setup>
import { ref, computed } from 'vue'

// Props å®šä¹‰
const props = defineProps({
  title: String,
  count: {
    type: Number,
    default: 0
  }
})

// Emits å®šä¹‰
const emit = defineEmits(['update', 'delete'])

// å“åº”å¼æ•°æ®
const localCount = ref(props.count)

// è®¡ç®—å±æ€§
const doubleCount = computed(() => localCount.value * 2)

// æ–¹æ³•
const handleClick = () => {
  localCount.value++
  emit('update', localCount.value)
}

// æš´éœ²ç»™çˆ¶ç»„ä»¶
defineExpose({
  reset: () => {
    localCount.value = 0
  }
})
</script>
```

### Vue 3.3 (2023å¹´5æœˆ)
**æ–°ç‰¹æ€§ï¼š**
- æ³›å‹ç»„ä»¶æ”¯æŒ
- æ”¹è¿›çš„ TypeScript æ”¯æŒ
- `defineModel` å®
- `defineSlots` å®
- æ”¹è¿›çš„ `v-bind` è¯­æ³•

**æ³›å‹ç»„ä»¶ç¤ºä¾‹ï¼š**
```vue
<script setup lang="ts" generic="T">
interface Props<T> {
  items: T[]
  itemKey: keyof T
}

const props = defineProps<Props<T>>()
</script>
```

**`defineModel` ç¤ºä¾‹ï¼š**
```vue
<script setup>
// åŒå‘ç»‘å®šç®€åŒ–
const modelValue = defineModel()
const count = defineModel('count', { default: 0 })

// ç­‰åŒäº
// const props = defineProps(['modelValue', 'count'])
// const emit = defineEmits(['update:modelValue', 'update:count'])
</script>
```

### Vue 3.4 (2023å¹´12æœˆ)
**æ€§èƒ½ä¼˜åŒ–ï¼š**
- æ›´å¿«çš„å“åº”å¼ç³»ç»Ÿ
- æ”¹è¿›çš„ç¼–è¯‘å™¨
- æ›´å¥½çš„ Tree-shaking
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–

**æ–°ç‰¹æ€§ï¼š**
- æ”¹è¿›çš„ `v-bind` è¯­æ³•
- æ›´å¥½çš„ TypeScript æ”¯æŒ
- æ€§èƒ½ç›‘æ§å·¥å…·

### Vue 3.5 (2024å¹´)
**é‡è¦æ›´æ–°ï¼š**
- æ›´å¿«çš„æ¸²æŸ“æ€§èƒ½
- æ”¹è¿›çš„å¼€å‘å·¥å…·
- æ›´å¥½çš„é”™è¯¯å¤„ç†
- æ–°çš„å®éªŒæ€§ç‰¹æ€§

### Vue 3.6+ (2024å¹´åŠä»¥å)
**æœªæ¥è§„åˆ’ï¼š**
- æ›´å¼ºå¤§çš„ç¼–è¯‘å™¨
- æ›´å¥½çš„æ€§èƒ½ä¼˜åŒ–
- æ›´å¤šå®éªŒæ€§ç‰¹æ€§
- ç”Ÿæ€ç³»ç»Ÿå®Œå–„

#### é©å‘½æ€§ç‰¹æ€§ï¼šæ— è™šæ‹ŸDOM (No Virtual DOM)

**æŠ€æœ¯èƒŒæ™¯ï¼š**
Vue 3.6+ å¼•å…¥äº†å¯é€‰çš„"æ— è™šæ‹ŸDOM"æ¨¡å¼ï¼Œè¿™æ˜¯å¯¹ä¼ ç»Ÿè™šæ‹ŸDOMæ¶æ„çš„é‡å¤§çªç ´ã€‚

**ä¼ ç»Ÿè™šæ‹ŸDOM vs æ— è™šæ‹ŸDOMï¼š**

```javascript
// ä¼ ç»Ÿè™šæ‹ŸDOMæµç¨‹
// 1. æ•°æ®å˜åŒ– â†’ 2. ç”Ÿæˆæ–°VNode â†’ 3. Diffç®—æ³•æ¯”è¾ƒ â†’ 4. æ‰¹é‡DOMæ›´æ–°

// æ— è™šæ‹ŸDOMæµç¨‹  
// 1. æ•°æ®å˜åŒ– â†’ 2. ç›´æ¥æ›´æ–°DOM (ç¼–è¯‘æ—¶ä¼˜åŒ–)
```

**æ ¸å¿ƒåŸç†ï¼š**
```vue
<!-- ç¼–è¯‘æ—¶ä¼˜åŒ–ç¤ºä¾‹ -->
<template>
  <div>
    <span>{{ count }}</span>
    <button @click="increment">+1</button>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const count = ref(0)
const increment = () => count.value++
</script>

<!-- æ— è™šæ‹ŸDOMç¼–è¯‘ç»“æœ -->
<script>
// ç¼–è¯‘å™¨ç›´æ¥ç”Ÿæˆé«˜æ•ˆçš„DOMæ›´æ–°ä»£ç 
function updateCount(newValue) {
  // ç›´æ¥å®šä½åˆ°éœ€è¦æ›´æ–°çš„DOMèŠ‚ç‚¹
  textNode.textContent = newValue
}

// æ— éœ€åˆ›å»ºVNodeï¼Œæ— éœ€Diffæ¯”è¾ƒ
</script>
```

**æ€§èƒ½ä¼˜åŠ¿å¯¹æ¯”ï¼š**

| æŒ‡æ ‡ | è™šæ‹ŸDOM | æ— è™šæ‹ŸDOM |
|------|---------|-----------|
| å†…å­˜å ç”¨ | è¾ƒé«˜ (éœ€è¦å­˜å‚¨VNodeæ ‘) | æ›´ä½ (ç›´æ¥æ“ä½œDOM) |
| é¦–æ¬¡æ¸²æŸ“ | ä¸­ç­‰ | æ›´å¿« (æ— VNodeåˆ›å»ºå¼€é”€) |
| æ›´æ–°æ€§èƒ½ | ä¾èµ–Diffç®—æ³• | ç›´æ¥æ›´æ–°ï¼Œæ›´å¿« |
| åŒ…ä½“ç§¯ | åŒ…å«VNodeç›¸å…³ä»£ç  | æ›´å° (å¯é€‰æ‹©æ€§ç§»é™¤) |
| é€‚ç”¨åœºæ™¯ | å¤æ‚åŠ¨æ€å†…å®¹ | ç®€å•é™æ€å†…å®¹ |

**ä½¿ç”¨åœºæ™¯åˆ†æï¼š**

```javascript
// é€‚åˆæ— è™šæ‹ŸDOMçš„åœºæ™¯
// 1. é™æ€å†…å®¹è¾ƒå¤šçš„é¡µé¢
<template>
  <div class="article">
    <h1>{{ title }}</h1>
    <p>{{ content }}</p>
    <div class="static-content">
      <!-- å¤§é‡é™æ€å†…å®¹ -->
    </div>
  </div>
</template>

// 2. è¡¨å•ç»„ä»¶
<template>
  <form>
    <input v-model="name" />
    <input v-model="email" />
    <button type="submit">æäº¤</button>
  </form>
</template>

// 3. åˆ—è¡¨æ¸²æŸ“ (ç®€å•åœºæ™¯)
<template>
  <ul>
    <li v-for="item in items" :key="item.id">
      {{ item.name }}
    </li>
  </ul>
</template>
```

**é…ç½®æ–¹å¼ï¼š**
```javascript
// vite.config.js
export default {
  plugins: [
    vue({
      // å¯ç”¨æ— è™šæ‹ŸDOMæ¨¡å¼
      noVirtualDOM: true,
      // æˆ–è€…é’ˆå¯¹ç‰¹å®šç»„ä»¶å¯ç”¨
      noVirtualDOM: {
        include: ['**/static/**/*.vue'],
        exclude: ['**/dynamic/**/*.vue']
      }
    })
  ]
}
```

**æ··åˆæ¨¡å¼ï¼š**
```vue
<!-- åŒä¸€åº”ç”¨ä¸­æ··åˆä½¿ç”¨ -->
<template>
  <!-- é™æ€éƒ¨åˆ†ä½¿ç”¨æ— è™šæ‹ŸDOM -->
  <StaticHeader />
  
  <!-- åŠ¨æ€éƒ¨åˆ†ä½¿ç”¨è™šæ‹ŸDOM -->
  <DynamicContent :data="complexData" />
</template>
```

**æ€§èƒ½æµ‹è¯•æ•°æ®ï¼š**
```javascript
// åŸºå‡†æµ‹è¯•ç»“æœ (ç¤ºä¾‹æ•°æ®)
const benchmarks = {
  'é¦–æ¬¡æ¸²æŸ“': {
    'è™šæ‹ŸDOM': '100ms',
    'æ— è™šæ‹ŸDOM': '60ms', // 40% æå‡
  },
  'æ›´æ–°æ€§èƒ½': {
    'è™šæ‹ŸDOM': '5ms',
    'æ— è™šæ‹ŸDOM': '2ms', // 60% æå‡
  },
  'å†…å­˜å ç”¨': {
    'è™šæ‹ŸDOM': '2MB',
    'æ— è™šæ‹ŸDOM': '1.2MB', // 40% å‡å°‘
  }
}
```

**æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆï¼š**

1. **ç¼–è¯‘å¤æ‚åº¦å¢åŠ **
   ```javascript
   // ç¼–è¯‘å™¨éœ€è¦æ›´æ™ºèƒ½çš„é™æ€åˆ†æ
   const compilerOptions = {
     hoistStatic: true,      // é™æ€æå‡
     cacheHandlers: true,    // äº‹ä»¶ç¼“å­˜
     noVirtualDOM: true      // æ— è™šæ‹ŸDOMä¼˜åŒ–
   }
   ```

2. **è°ƒè¯•å·¥å…·é€‚é…**
   ```javascript
   // Vue DevTools éœ€è¦é€‚é…æ— è™šæ‹ŸDOMæ¨¡å¼
   if (__DEV__ && !options.noVirtualDOM) {
     // ä¼ ç»Ÿè°ƒè¯•æ¨¡å¼
   } else {
     // æ— è™šæ‹ŸDOMè°ƒè¯•æ¨¡å¼
   }
   ```

3. **ç”Ÿæ€ç³»ç»Ÿå…¼å®¹æ€§**
   ```javascript
   // ç¬¬ä¸‰æ–¹åº“éœ€è¦æ£€æµ‹è¿è¡Œæ¨¡å¼
   export function isNoVirtualDOM() {
     return !!window.__VUE_NO_VIRTUAL_DOM__
   }
   ```

**æœªæ¥å‘å±•æ–¹å‘ï¼š**

1. **æ™ºèƒ½æ¨¡å¼åˆ‡æ¢**
   ```javascript
   // ç¼–è¯‘å™¨è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ¨¡å¼
   const autoMode = {
     // æ ¹æ®ç»„ä»¶å¤æ‚åº¦è‡ªåŠ¨é€‰æ‹©
     threshold: 100, // èŠ‚ç‚¹æ•°é‡é˜ˆå€¼
     fallback: 'virtual-dom' // å›é€€ç­–ç•¥
   }
   ```

2. **æ¸è¿›å¼è¿ç§»**
   ```javascript
   // æ”¯æŒè¿è¡Œæ—¶æ¨¡å¼åˆ‡æ¢
   const app = createApp(App)
   app.config.compilerOptions.noVirtualDOM = true
   ```

3. **æ€§èƒ½ç›‘æ§**
   ```javascript
   // å†…ç½®æ€§èƒ½åˆ†æå·¥å…·
   const performance = {
     trackMode: true,
     metrics: ['render-time', 'memory-usage', 'update-frequency']
   }
   ```

**æœ€ä½³å®è·µå»ºè®®ï¼š**

1. **é€‚ç”¨åœºæ™¯åˆ¤æ–­**
   - é™æ€å†…å®¹ > 70% â†’ æ¨èæ— è™šæ‹ŸDOM
   - å¤æ‚äº¤äº’è¾ƒå¤š â†’ ä¿æŒè™šæ‹ŸDOM
   - æ€§èƒ½æ•æ„Ÿåœºæ™¯ â†’ æ··åˆä½¿ç”¨

2. **è¿ç§»ç­–ç•¥**
   ```javascript
   // æ¸è¿›å¼è¿ç§»æ­¥éª¤
   const migrationSteps = [
     '1. è¯†åˆ«é™æ€ç»„ä»¶',
     '2. å¯ç”¨æ— è™šæ‹ŸDOMæ¨¡å¼',
     '3. æ€§èƒ½æµ‹è¯•éªŒè¯',
     '4. é€æ­¥æ‰©å±•åˆ°æ›´å¤šç»„ä»¶'
   ]
   ```

3. **æ€§èƒ½ç›‘æ§**
   ```javascript
   // å…³é”®æŒ‡æ ‡ç›‘æ§
   const metrics = {
     'é¦–æ¬¡æ¸²æŸ“æ—¶é—´': 'FCP < 1.5s',
     'äº¤äº’å“åº”æ—¶é—´': 'TTI < 3.8s',
     'å†…å­˜ä½¿ç”¨': '< 50MB',
     'æ›´æ–°é¢‘ç‡': '> 60fps'
   }
   ```

**æ€»ç»“ï¼š**
æ— è™šæ‹ŸDOMæ˜¯Vue 3.6+æœ€é‡è¦çš„æŠ€æœ¯çªç ´ä¹‹ä¸€ï¼Œå®ƒé€šè¿‡ç¼–è¯‘æ—¶ä¼˜åŒ–ç›´æ¥æ“ä½œDOMï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹èƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚è¿™æ ‡å¿—ç€Vueä»"è™šæ‹ŸDOMä¼˜å…ˆ"å‘"æ€§èƒ½ä¼˜å…ˆ"çš„è½¬å˜ï¼Œä¸ºæœªæ¥çš„Webåº”ç”¨å¼€å‘æä¾›äº†æ–°çš„å¯èƒ½æ€§ã€‚

## ç‰ˆæœ¬å¯¹æ¯”æ€»ç»“

### Vue 2.x vs Vue 3.x æ ¸å¿ƒå·®å¼‚

| ç‰¹æ€§ | Vue 2.x | Vue 3.x |
|------|---------|---------|
| å“åº”å¼ç³»ç»Ÿ | Object.defineProperty | Proxy |
| ç»„ä»¶API | Options API | Composition API + Options API |
| æ€§èƒ½ | ä¸­ç­‰ | æ˜¾è‘—æå‡ |
| åŒ…ä½“ç§¯ | è¾ƒå¤§ | æ›´å° (Tree-shaking) |
| TypeScript | æœ‰é™æ”¯æŒ | åŸç”Ÿæ”¯æŒ |
| ç¼–è¯‘ä¼˜åŒ– | è¾ƒå°‘ | å¤§é‡ä¼˜åŒ– |

### æ€§èƒ½å¯¹æ¯”
```javascript
// Vue 2.x å“åº”å¼
Object.defineProperty(obj, 'key', {
  get() { return value },
  set(newVal) { 
    value = newVal
    // è§¦å‘æ›´æ–°
  }
})

// Vue 3.x å“åº”å¼
const reactive = new Proxy(obj, {
  get(target, key) { return target[key] },
  set(target, key, value) {
    target[key] = value
    // è§¦å‘æ›´æ–°
    return true
  }
})
```

## æœªæ¥è¶‹åŠ¿åˆ†æ

### 1. æ€§èƒ½æŒç»­ä¼˜åŒ–
- **ç¼–è¯‘æ—¶ä¼˜åŒ–**ï¼šæ›´å¤šé™æ€åˆ†æï¼Œå‡å°‘è¿è¡Œæ—¶å¼€é”€
- **å“åº”å¼ç³»ç»Ÿ**ï¼šæ›´ç²¾ç»†çš„ä¾èµ–è¿½è¸ª
- **æ¸²æŸ“ä¼˜åŒ–**ï¼šæ›´æ™ºèƒ½çš„ diff ç®—æ³•

### 2. å¼€å‘ä½“éªŒæå‡
- **TypeScript é›†æˆ**ï¼šæ›´å®Œå–„çš„ç±»å‹æ¨å¯¼
- **å¼€å‘å·¥å…·**ï¼šæ›´å¼ºå¤§çš„è°ƒè¯•å’Œåˆ†æå·¥å…·
- **æ–‡æ¡£å’Œæ•™ç¨‹**ï¼šæ›´ä¸°å¯Œçš„å­¦ä¹ èµ„æº

### 3. ç”Ÿæ€ç³»ç»Ÿå‘å±•
- **å®˜æ–¹åº“**ï¼šVue Routerã€Piniaã€Vite ç­‰æŒç»­æ›´æ–°
- **ç¤¾åŒºç”Ÿæ€**ï¼šæ›´å¤šç¬¬ä¸‰æ–¹åº“å’Œå·¥å…·
- **ä¼ä¸šé‡‡ç”¨**ï¼šæ›´å¤šå¤§å‹é¡¹ç›®é‡‡ç”¨ Vue 3

### 4. æ–°ç‰¹æ€§å±•æœ›
- **Suspense å®Œå–„**ï¼šæ›´å¥½çš„å¼‚æ­¥ç»„ä»¶æ”¯æŒ
- **ç¼–è¯‘æ—¶ä¼˜åŒ–**ï¼šæ›´å¤šç¼–è¯‘æ—¶ç‰¹æ€§
- **æœåŠ¡ç«¯æ¸²æŸ“**ï¼šæ›´å¼ºå¤§çš„ SSR èƒ½åŠ›
- **å¾®å‰ç«¯**ï¼šæ›´å¥½çš„å¾®å‰ç«¯æ”¯æŒ

### 5. æŠ€æœ¯æ¼”è¿›æ–¹å‘
```javascript
// æœªæ¥å¯èƒ½çš„è¯­æ³•
<script setup>
// æ›´ç®€æ´çš„å“åº”å¼è¯­æ³•
let count = $ref(0)
let name = $ref('Vue')

// è‡ªåŠ¨è§£åŒ…
console.log(count) // ä¸éœ€è¦ .value

// æ›´å¼ºå¤§çš„ç¼–è¯‘æ—¶ä¼˜åŒ–
const expensive = $computed(() => {
  // å¤æ‚çš„è®¡ç®—é€»è¾‘
})
</script>
```

## è¿ç§»å»ºè®®

### Vue 2.x åˆ° Vue 3.x è¿ç§»ç­–ç•¥
1. **æ¸è¿›å¼è¿ç§»**ï¼šä½¿ç”¨ Vue 2.7 ä½œä¸ºè¿‡æ¸¡ç‰ˆæœ¬
2. **Composition API**ï¼šé€æ­¥å¼•å…¥æ–°çš„ API
3. **ç”Ÿæ€ç³»ç»Ÿ**ï¼šæ›´æ–°ç›¸å…³ä¾èµ–åº“
4. **æµ‹è¯•è¦†ç›–**ï¼šç¡®ä¿åŠŸèƒ½å®Œæ•´æ€§

### æœ€ä½³å®è·µ
- ä¼˜å…ˆä½¿ç”¨ Composition API
- å……åˆ†åˆ©ç”¨ TypeScript
- å…³æ³¨æ€§èƒ½ä¼˜åŒ–
- ä¿æŒä»£ç ç®€æ´

---

*æœ¬æ–‡æ¡£å°†æŒç»­æ›´æ–°ï¼Œåæ˜  Vue ç”Ÿæ€ç³»ç»Ÿçš„æœ€æ–°å‘å±•ã€‚*

## Vue 2 åˆ° Vue 3 è¿ç§»å·¥å…·è¯¦è§£

### å®˜æ–¹è¿ç§»å·¥å…·

#### 1. Vue Migration Build
**å®˜æ–¹æ¨èçš„è¿ç§»å·¥å…·ï¼Œæ”¯æŒæ¸è¿›å¼è¿ç§»**

```bash
# å®‰è£…è¿ç§»æ„å»ºç‰ˆæœ¬
npm install @vue/compat@^3.4.0
```

**é…ç½®æ–¹å¼ï¼š**
```javascript
// vite.config.js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [
    vue({
      // å¯ç”¨å…¼å®¹æ¨¡å¼
      compat: {
        // å¯ç”¨æ‰€æœ‰å…¼å®¹æ€§è­¦å‘Š
        warn: true,
        // å¯ç”¨è¿è¡Œæ—¶å…¼å®¹æ€§æ£€æŸ¥
        runtime: true
      }
    })
  ]
})
```

**ä¸»è¦åŠŸèƒ½ï¼š**
- è¿è¡Œæ—¶å…¼å®¹æ€§æ£€æŸ¥
- è‡ªåŠ¨è­¦å‘Šä¸å…¼å®¹çš„APIä½¿ç”¨
- æ”¯æŒVue 2è¯­æ³•åœ¨Vue 3ç¯å¢ƒä¸­è¿è¡Œ
- æ¸è¿›å¼è¿ç§»æ”¯æŒ

#### 2. @vue/compat å…¼å®¹æ€§æ£€æŸ¥
```javascript
// è‡ªåŠ¨æ£€æµ‹ä¸å…¼å®¹çš„API
const compatWarnings = {
  'GLOBAL_MOUNT': 'Vue.use() å·²åºŸå¼ƒï¼Œä½¿ç”¨ app.use()',
  'GLOBAL_EXTEND': 'Vue.extend() å·²åºŸå¼ƒ',
  'GLOBAL_PROTOTYPE': 'Vue.prototype å·²åºŸå¼ƒ',
  'GLOBAL_SET': 'Vue.set() å·²åºŸå¼ƒ',
  'GLOBAL_DELETE': 'Vue.delete() å·²åºŸå¼ƒ',
  'GLOBAL_NEXT_TICK': 'Vue.nextTick() å·²åºŸå¼ƒ'
}
```

### ç¬¬ä¸‰æ–¹è¿ç§»å·¥å…·

#### 1. vue-migration-helper
**è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤å¸¸è§è¿ç§»é—®é¢˜**

```bash
# å®‰è£…å·¥å…·
npm install -g vue-migration-helper

# è¿è¡Œè¿ç§»æ£€æŸ¥
vue-migration-helper check ./src

# è‡ªåŠ¨ä¿®å¤éƒ¨åˆ†é—®é¢˜
vue-migration-helper fix ./src
```

**æ£€æµ‹èŒƒå›´ï¼š**
```javascript
const migrationChecks = {
  // å…¨å±€APIå˜æ›´
  globalAPI: [
    'Vue.use() â†’ app.use()',
    'Vue.component() â†’ app.component()',
    'Vue.directive() â†’ app.directive()'
  ],
  
  // ç”Ÿå‘½å‘¨æœŸé’©å­
  lifecycle: [
    'beforeDestroy â†’ beforeUnmount',
    'destroyed â†’ unmounted'
  ],
  
  // äº‹ä»¶ç³»ç»Ÿ
  events: [
    '$on/$off/$once å·²ç§»é™¤',
    'eventBus æ›¿ä»£æ–¹æ¡ˆ'
  ],
  
  // è¿‡æ»¤å™¨
  filters: [
    'filters å·²ç§»é™¤',
    'methods æˆ– computed æ›¿ä»£'
  ]
}
```

#### 2. vue-codemod
**åŸºäºASTçš„ä»£ç è½¬æ¢å·¥å…·**

```bash
# å®‰è£…codemodå·¥å…·
npm install -g jscodeshift
npm install -g @vue/codemod

# è¿è¡Œè½¬æ¢
jscodeshift -t @vue/codemod/transforms/global-api.js src/
jscodeshift -t @vue/codemod/transforms/new-component-api.js src/
```

**è½¬æ¢ç¤ºä¾‹ï¼š**
```javascript
// è½¬æ¢å‰ (Vue 2)
export default {
  name: 'MyComponent',
  data() {
    return { count: 0 }
  },
  methods: {
    increment() {
      this.count++
    }
  }
}

// è½¬æ¢å (Vue 3)
import { ref } from 'vue'

export default {
  name: 'MyComponent',
  setup() {
    const count = ref(0)
    
    const increment = () => {
      count.value++
    }
    
    return {
      count,
      increment
    }
  }
}
```

### è‡ªå®šä¹‰è¿ç§»å·¥å…·å¼€å‘

#### 1. è¯­æ³•éªŒè¯å·¥å…·æ¶æ„

```javascript
/* @source cursor @line_count 200 @branch master */

// migration-validator.js
import { parse } from '@vue/compiler-sfc'
import { parse as parseJS } from '@babel/parser'
import traverse from '@babel/traverse'

class VueMigrationValidator {
  constructor(options = {}) {
    this.options = {
      strict: false,
      autoFix: false,
      ...options
    }
    this.issues = []
  }

  // éªŒè¯Vueæ–‡ä»¶
  validateVueFile(filePath, content) {
    const issues = []
    
    try {
      const { descriptor } = parse(content)
      
      // æ£€æŸ¥æ¨¡æ¿
      if (descriptor.template) {
        issues.push(...this.validateTemplate(descriptor.template))
      }
      
      // æ£€æŸ¥è„šæœ¬
      if (descriptor.script) {
        issues.push(...this.validateScript(descriptor.script))
      }
      
      // æ£€æŸ¥æ ·å¼
      if (descriptor.styles) {
        issues.push(...this.validateStyles(descriptor.styles))
      }
      
    } catch (error) {
      issues.push({
        type: 'error',
        message: `è§£æé”™è¯¯: ${error.message}`,
        line: error.line,
        column: error.column
      })
    }
    
    return issues
  }

  // éªŒè¯æ¨¡æ¿è¯­æ³•
  validateTemplate(template) {
    const issues = []
    
    // æ£€æŸ¥å·²åºŸå¼ƒçš„æŒ‡ä»¤
    const deprecatedDirectives = [
      { pattern: /v-on:keyup\.enter/, replacement: 'v-on:keyup.enter' },
      { pattern: /v-on:keyup\.tab/, replacement: 'v-on:keyup.tab' }
    ]
    
    // æ£€æŸ¥è¿‡æ»¤å™¨è¯­æ³•
    if (template.content.includes('|')) {
      issues.push({
        type: 'warning',
        message: 'è¿‡æ»¤å™¨è¯­æ³•å·²åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨methodsæˆ–computed',
        line: this.findLineNumber(template.content, '|'),
        suggestion: 'ä½¿ç”¨è®¡ç®—å±æ€§æˆ–æ–¹æ³•æ›¿ä»£è¿‡æ»¤å™¨'
      })
    }
    
    return issues
  }

  // éªŒè¯è„šæœ¬è¯­æ³•
  validateScript(script) {
    const issues = []
    
    try {
      const ast = parseJS(script.content, {
        sourceType: 'module',
        plugins: ['jsx', 'typescript']
      })
      
      traverse(ast, {
        // æ£€æŸ¥Vue 2 APIä½¿ç”¨
        CallExpression(path) {
          const { node } = path
          
          // æ£€æŸ¥Vue.use()
          if (node.callee.type === 'MemberExpression' &&
              node.callee.object.name === 'Vue' &&
              node.callee.property.name === 'use') {
            issues.push({
              type: 'error',
              message: 'Vue.use() å·²åºŸå¼ƒï¼Œä½¿ç”¨ app.use()',
              line: node.loc?.start.line,
              suggestion: 'å°† Vue.use() æ›¿æ¢ä¸º app.use()'
            })
          }
        },
        
        // æ£€æŸ¥ç”Ÿå‘½å‘¨æœŸé’©å­
        ObjectMethod(path) {
          const { node } = path
          const deprecatedHooks = ['beforeDestroy', 'destroyed']
          
          if (deprecatedHooks.includes(node.key.name)) {
            const replacements = {
              beforeDestroy: 'beforeUnmount',
              destroyed: 'unmounted'
            }
            
            issues.push({
              type: 'warning',
              message: `ç”Ÿå‘½å‘¨æœŸé’©å­ ${node.key.name} å·²åºŸå¼ƒ`,
              line: node.loc?.start.line,
              suggestion: `ä½¿ç”¨ ${replacements[node.key.name]} æ›¿ä»£`
            })
          }
        }
      })
      
    } catch (error) {
      issues.push({
        type: 'error',
        message: `è„šæœ¬è§£æé”™è¯¯: ${error.message}`,
        line: error.line
      })
    }
    
    return issues
  }

  // ç”Ÿæˆè¿ç§»æŠ¥å‘Š
  generateReport() {
    const report = {
      summary: {
        total: this.issues.length,
        errors: this.issues.filter(i => i.type === 'error').length,
        warnings: this.issues.filter(i => i.type === 'warning').length
      },
      issues: this.issues,
      recommendations: this.generateRecommendations()
    }
    
    return report
  }

  // ç”Ÿæˆè¿ç§»å»ºè®®
  generateRecommendations() {
    const recommendations = []
    
    const errorCount = this.issues.filter(i => i.type === 'error').length
    const warningCount = this.issues.filter(i => i.type === 'warning').length
    
    if (errorCount > 0) {
      recommendations.push('ä¼˜å…ˆä¿®å¤æ‰€æœ‰é”™è¯¯ï¼Œè¿™äº›æ˜¯è¿ç§»çš„å¿…éœ€æ­¥éª¤')
    }
    
    if (warningCount > 0) {
      recommendations.push('é€æ­¥å¤„ç†è­¦å‘Šï¼Œè¿™äº›æ˜¯æ¨èçš„æ”¹è¿›')
    }
    
    return recommendations
  }
}

export default VueMigrationValidator
```

#### 2. ä¾èµ–åˆ†æå·¥å…·

```javascript
// dependency-analyzer.js
import { execSync } from 'child_process'
import fs from 'fs'
import path from 'path'

class DependencyAnalyzer {
  constructor() {
    this.vue2Dependencies = new Set()
    this.vue3Dependencies = new Set()
    this.incompatibleDependencies = new Set()
  }

  // åˆ†æpackage.jsonä¾èµ–
  analyzeDependencies(packageJsonPath) {
    const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf8'))
    const allDependencies = {
      ...packageJson.dependencies,
      ...packageJson.devDependencies
    }

    const analysis = {
      vue2Deps: [],
      vue3Deps: [],
      incompatible: [],
      recommendations: []
    }

    // Vue 2 ç›¸å…³ä¾èµ–
    const vue2Patterns = [
      /^vue@^2\./,
      /^vue-router@^3\./,
      /^vuex@^3\./,
      /^@vue\/cli/,
      /^vue-template-compiler/
    ]

    // Vue 3 ç›¸å…³ä¾èµ–
    const vue3Patterns = [
      /^vue@^3\./,
      /^vue-router@^4\./,
      /^pinia/,
      /^@vue\/compiler-sfc/
    ]

    // ä¸å…¼å®¹çš„ä¾èµ–
    const incompatiblePatterns = [
      /^element-ui/,
      /^iview/,
      /^ant-design-vue@^1\./
    ]

    Object.entries(allDependencies).forEach(([name, version]) => {
      const fullName = `${name}@${version}`
      
      if (vue2Patterns.some(pattern => pattern.test(fullName))) {
        analysis.vue2Deps.push({ name, version, fullName })
      }
      
      if (vue3Patterns.some(pattern => pattern.test(fullName))) {
        analysis.vue3Deps.push({ name, version, fullName })
      }
      
      if (incompatiblePatterns.some(pattern => pattern.test(fullName))) {
        analysis.incompatible.push({ name, version, fullName })
      }
    })

    // ç”Ÿæˆè¿ç§»å»ºè®®
    analysis.recommendations = this.generateMigrationRecommendations(analysis)

    return analysis
  }

  // ç”Ÿæˆè¿ç§»å»ºè®®
  generateMigrationRecommendations(analysis) {
    const recommendations = []

    // Vue 2 ä¾èµ–è¿ç§»å»ºè®®
    const migrationMap = {
      'vue-router': { from: '^3.x', to: '^4.x', breaking: true },
      'vuex': { from: '^3.x', to: '^4.x', breaking: true },
      'element-ui': { from: '^2.x', to: 'element-plus', breaking: true },
      'iview': { from: '^4.x', to: 'view-design', breaking: true },
      'ant-design-vue': { from: '^1.x', to: '^3.x', breaking: true }
    }

    analysis.vue2Deps.forEach(dep => {
      if (migrationMap[dep.name]) {
        const migration = migrationMap[dep.name]
        recommendations.push({
          type: 'dependency',
          package: dep.name,
          current: dep.version,
          target: migration.to,
          breaking: migration.breaking,
          description: `å°† ${dep.name} ä» ${dep.version} å‡çº§åˆ° ${migration.to}`
        })
      }
    })

    return recommendations
  }

  // æ£€æŸ¥ä¾èµ–å†²çª
  checkConflicts(analysis) {
    const conflicts = []
    
    // æ£€æŸ¥Vueç‰ˆæœ¬å†²çª
    const vue2Deps = analysis.vue2Deps.filter(dep => dep.name === 'vue')
    const vue3Deps = analysis.vue3Deps.filter(dep => dep.name === 'vue')
    
    if (vue2Deps.length > 0 && vue3Deps.length > 0) {
      conflicts.push({
        type: 'version_conflict',
        message: 'æ£€æµ‹åˆ°Vue 2å’ŒVue 3ç‰ˆæœ¬å†²çª',
        vue2: vue2Deps[0],
        vue3: vue3Deps[0],
        resolution: 'é€‰æ‹©ä¸€ä¸ªVueç‰ˆæœ¬è¿›è¡Œè¿ç§»'
      })
    }
    
    return conflicts
  }
}

export default DependencyAnalyzer
```

#### 3. è‡ªåŠ¨è¿ç§»å·¥å…·

```javascript
// auto-migrator.js
import fs from 'fs'
import path from 'path'
import { transform } from '@babel/core'
import VueMigrationValidator from './migration-validator.js'

class AutoMigrator {
  constructor(options = {}) {
    this.options = {
      backup: true,
      dryRun: false,
      ...options
    }
    this.validator = new VueMigrationValidator()
    this.migrationCount = 0
  }

  // è‡ªåŠ¨è¿ç§»Vueæ–‡ä»¶
  async migrateVueFile(filePath) {
    const content = fs.readFileSync(filePath, 'utf8')
    const originalContent = content
    
    // å¤‡ä»½åŸæ–‡ä»¶
    if (this.options.backup) {
      const backupPath = `${filePath}.backup`
      fs.writeFileSync(backupPath, content)
    }
    
    let migratedContent = content
    
    // åº”ç”¨è¿ç§»è§„åˆ™
    migratedContent = this.applyMigrationRules(migratedContent)
    
    // éªŒè¯è¿ç§»ç»“æœ
    const issues = this.validator.validateVueFile(filePath, migratedContent)
    const errors = issues.filter(i => i.type === 'error')
    
    if (errors.length > 0) {
      console.warn(`è¿ç§»æ–‡ä»¶ ${filePath} æ—¶å‘ç°é”™è¯¯:`, errors)
      return { success: false, errors }
    }
    
    // å†™å…¥è¿ç§»åçš„æ–‡ä»¶
    if (!this.options.dryRun) {
      fs.writeFileSync(filePath, migratedContent)
    }
    
    this.migrationCount++
    
    return {
      success: true,
      changes: this.detectChanges(originalContent, migratedContent)
    }
  }

  // åº”ç”¨è¿ç§»è§„åˆ™
  applyMigrationRules(content) {
    let result = content
    
    // è§„åˆ™1: ç”Ÿå‘½å‘¨æœŸé’©å­è¿ç§»
    const lifecycleMigrations = [
      { from: 'beforeDestroy', to: 'beforeUnmount' },
      { from: 'destroyed', to: 'unmounted' }
    ]
    
    lifecycleMigrations.forEach(migration => {
      const regex = new RegExp(`\\b${migration.from}\\b`, 'g')
      result = result.replace(regex, migration.to)
    })
    
    // è§„åˆ™2: å…¨å±€APIè¿ç§»
    const globalAPIMigrations = [
      { from: 'Vue.use(', to: 'app.use(' },
      { from: 'Vue.component(', to: 'app.component(' },
      { from: 'Vue.directive(', to: 'app.directive(' }
    ]
    
    globalAPIMigrations.forEach(migration => {
      result = result.replace(new RegExp(migration.from, 'g'), migration.to)
    })
    
    // è§„åˆ™3: äº‹ä»¶æ€»çº¿è¿ç§»
    if (result.includes('$on') || result.includes('$off') || result.includes('$once')) {
      result = this.migrateEventBus(result)
    }
    
    // è§„åˆ™4: è¿‡æ»¤å™¨è¿ç§»
    if (result.includes('filters:')) {
      result = this.migrateFilters(result)
    }
    
    return result
  }

  // è¿ç§»äº‹ä»¶æ€»çº¿
  migrateEventBus(content) {
    // æ›¿æ¢äº‹ä»¶æ€»çº¿ä¸ºmitt
    let result = content
    
    // æ·»åŠ mittå¯¼å…¥
    if (!result.includes('import mitt')) {
      result = result.replace(
        /import.*from ['"]vue['"]/,
        "import { createApp } from 'vue'\nimport mitt from 'mitt'"
      )
    }
    
    // æ›¿æ¢äº‹ä»¶æ€»çº¿ä½¿ç”¨
    result = result.replace(/\$on\(/g, 'emitter.on(')
    result = result.replace(/\$off\(/g, 'emitter.off(')
    result = result.replace(/\$once\(/g, 'emitter.once(')
    result = result.replace(/\$emit\(/g, 'emitter.emit(')
    
    return result
  }

  // è¿ç§»è¿‡æ»¤å™¨
  migrateFilters(content) {
    // å°†è¿‡æ»¤å™¨è½¬æ¢ä¸ºè®¡ç®—å±æ€§æˆ–æ–¹æ³•
    const filterRegex = /filters:\s*{([^}]+)}/g
    let result = content
    
    result = result.replace(filterRegex, (match, filtersContent) => {
      const filters = this.parseFilters(filtersContent)
      const computedProps = filters.map(filter => 
        `computed: {\n  ${filter.name}() {\n    return ${filter.body}\n  }\n}`
      ).join(',\n')
      
      return computedProps
    })
    
    return result
  }

  // è§£æè¿‡æ»¤å™¨å†…å®¹
  parseFilters(filtersContent) {
    const filters = []
    const lines = filtersContent.split('\n')
    
    let currentFilter = null
    
    lines.forEach(line => {
      const trimmed = line.trim()
      if (trimmed.includes(':')) {
        const [name, body] = trimmed.split(':').map(s => s.trim())
        filters.push({ name, body })
      }
    })
    
    return filters
  }

  // æ£€æµ‹å˜æ›´
  detectChanges(original, migrated) {
    const changes = []
    
    if (original !== migrated) {
      changes.push({
        type: 'content_changed',
        description: 'æ–‡ä»¶å†…å®¹å·²æ›´æ–°'
      })
    }
    
    return changes
  }

  // æ‰¹é‡è¿ç§»
  async migrateDirectory(dirPath) {
    const files = this.findVueFiles(dirPath)
    const results = []
    
    for (const file of files) {
      try {
        const result = await this.migrateVueFile(file)
        results.push({ file, ...result })
      } catch (error) {
        results.push({ file, success: false, error: error.message })
      }
    }
    
    return results
  }

  // æŸ¥æ‰¾Vueæ–‡ä»¶
  findVueFiles(dirPath) {
    const files = []
    
    const walk = (currentPath) => {
      const items = fs.readdirSync(currentPath)
      
      items.forEach(item => {
        const fullPath = path.join(currentPath, item)
        const stat = fs.statSync(fullPath)
        
        if (stat.isDirectory()) {
          walk(fullPath)
        } else if (item.endsWith('.vue')) {
          files.push(fullPath)
        }
      })
    }
    
    walk(dirPath)
    return files
  }

  // ç”Ÿæˆè¿ç§»æŠ¥å‘Š
  generateMigrationReport(results) {
    const successful = results.filter(r => r.success)
    const failed = results.filter(r => !r.success)
    
    return {
      summary: {
        total: results.length,
        successful: successful.length,
        failed: failed.length,
        successRate: (successful.length / results.length * 100).toFixed(2) + '%'
      },
      details: {
        successful,
        failed
      },
      recommendations: this.generatePostMigrationRecommendations(results)
    }
  }

  // ç”Ÿæˆè¿ç§»åå»ºè®®
  generatePostMigrationRecommendations(results) {
    const recommendations = []
    
    if (results.some(r => r.success && r.changes?.some(c => c.type === 'content_changed'))) {
      recommendations.push('æ£€æŸ¥è¿ç§»åçš„ä»£ç ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸')
    }
    
    if (results.some(r => !r.success)) {
      recommendations.push('æ‰‹åŠ¨å¤„ç†è¿ç§»å¤±è´¥çš„æ–‡ä»¶')
    }
    
    recommendations.push('è¿è¡Œæµ‹è¯•å¥—ä»¶éªŒè¯åŠŸèƒ½')
    recommendations.push('æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œé…ç½®')
    
    return recommendations
  }
}

export default AutoMigrator
```

#### 4. ä½¿ç”¨ç¤ºä¾‹

```javascript
// migration-cli.js
#!/usr/bin/env node

import AutoMigrator from './auto-migrator.js'
import DependencyAnalyzer from './dependency-analyzer.js'
import VueMigrationValidator from './migration-validator.js'

async function main() {
  const args = process.argv.slice(2)
  const command = args[0]
  
  switch (command) {
    case 'analyze':
      await analyzeProject(args[1] || '.')
      break
    case 'migrate':
      await migrateProject(args[1] || '.')
      break
    case 'validate':
      await validateProject(args[1] || '.')
      break
    default:
      console.log(`
Vue Migration Tool

Usage:
  node migration-cli.js analyze [path]    - åˆ†æé¡¹ç›®è¿ç§»éœ€æ±‚
  node migration-cli.js migrate [path]    - è‡ªåŠ¨è¿ç§»é¡¹ç›®
  node migration-cli.js validate [path]   - éªŒè¯è¿ç§»ç»“æœ
      `)
  }
}

async function analyzeProject(projectPath) {
  console.log('ğŸ” åˆ†æé¡¹ç›®è¿ç§»éœ€æ±‚...')
  
  const analyzer = new DependencyAnalyzer()
  const validator = new VueMigrationValidator()
  
  // åˆ†æä¾èµ–
  const depAnalysis = analyzer.analyzeDependencies(path.join(projectPath, 'package.json'))
  
  // åˆ†æä»£ç 
  const migrator = new AutoMigrator({ dryRun: true })
  const codeResults = await migrator.migrateDirectory(projectPath)
  
  console.log('\nğŸ“Š åˆ†ææŠ¥å‘Š:')
  console.log('ä¾èµ–åˆ†æ:', depAnalysis)
  console.log('ä»£ç åˆ†æ:', migrator.generateMigrationReport(codeResults))
}

async function migrateProject(projectPath) {
  console.log('ğŸš€ å¼€å§‹è‡ªåŠ¨è¿ç§»...')
  
  const migrator = new AutoMigrator({
    backup: true,
    dryRun: false
  })
  
  const results = await migrator.migrateDirectory(projectPath)
  const report = migrator.generateMigrationReport(results)
  
  console.log('\nâœ… è¿ç§»å®Œæˆ!')
  console.log('è¿ç§»æŠ¥å‘Š:', report)
}

async function validateProject(projectPath) {
  console.log('âœ… éªŒè¯è¿ç§»ç»“æœ...')
  
  const validator = new VueMigrationValidator()
  const migrator = new AutoMigrator({ dryRun: true })
  
  const results = await migrator.migrateDirectory(projectPath)
  const issues = results.flatMap(r => r.issues || [])
  
  console.log('\nğŸ” éªŒè¯ç»“æœ:')
  console.log('å‘ç°çš„é—®é¢˜:', issues)
}

main().catch(console.error)
```

### è¿ç§»å·¥å…·çš„æœ€ä½³å®è·µ

#### 1. æ¸è¿›å¼è¿ç§»ç­–ç•¥
```javascript
const migrationStrategy = {
  phase1: {
    name: 'å‡†å¤‡é˜¶æ®µ',
    tasks: [
      'å®‰è£…Vue 3å…¼å®¹æ€§æ„å»º',
      'æ›´æ–°æ„å»ºå·¥å…·é…ç½®',
      'è¿è¡Œè¿ç§»æ£€æŸ¥å·¥å…·'
    ]
  },
  phase2: {
    name: 'ä¾èµ–è¿ç§»',
    tasks: [
      'æ›´æ–°Vue Routeråˆ°v4',
      'è¿ç§»Vuexåˆ°Pinia',
      'æ›´æ–°UIç»„ä»¶åº“'
    ]
  },
  phase3: {
    name: 'ä»£ç è¿ç§»',
    tasks: [
      'è¿ç§»å…¨å±€API',
      'æ›´æ–°ç”Ÿå‘½å‘¨æœŸé’©å­',
      'è¿ç§»äº‹ä»¶æ€»çº¿'
    ]
  },
  phase4: {
    name: 'ä¼˜åŒ–é˜¶æ®µ',
    tasks: [
      'é‡‡ç”¨Composition API',
      'ä½¿ç”¨script setupè¯­æ³•',
      'æ€§èƒ½ä¼˜åŒ–'
    ]
  }
}
```

#### 2. æµ‹è¯•ç­–ç•¥
```javascript
const testingStrategy = {
  unit: {
    description: 'å•å…ƒæµ‹è¯•éªŒè¯',
    tools: ['Jest', 'Vitest'],
    focus: ['ç»„ä»¶é€»è¾‘', 'å·¥å…·å‡½æ•°']
  },
  integration: {
    description: 'é›†æˆæµ‹è¯•éªŒè¯',
    tools: ['Cypress', 'Playwright'],
    focus: ['é¡µé¢äº¤äº’', 'è·¯ç”±è·³è½¬']
  },
  e2e: {
    description: 'ç«¯åˆ°ç«¯æµ‹è¯•',
    tools: ['Cypress', 'Playwright'],
    focus: ['å®Œæ•´ç”¨æˆ·æµç¨‹']
  }
}
```

#### 3. å›æ»šç­–ç•¥
```javascript
const rollbackStrategy = {
  code: {
    backup: '.backupæ–‡ä»¶',
    git: 'ä½¿ç”¨Gitåˆ†æ”¯',
    description: 'ä¿ç•™åŸå§‹ä»£ç å¤‡ä»½'
  },
  dependencies: {
    lockfile: 'package-lock.jsonå¤‡ä»½',
    node_modules: 'ä¿ç•™Vue 2ç‰ˆæœ¬',
    description: 'ä¾èµ–ç‰ˆæœ¬ç®¡ç†'
  },
  deployment: {
    blueGreen: 'è“ç»¿éƒ¨ç½²',
    canary: 'é‡‘ä¸é›€å‘å¸ƒ',
    description: 'æ¸è¿›å¼éƒ¨ç½²ç­–ç•¥'
  }
}
```

### æ€»ç»“

Vue 2åˆ°Vue 3çš„è¿ç§»æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘ï¼š

1. **å·¥å…·é€‰æ‹©**ï¼šå®˜æ–¹å·¥å…· + ç¬¬ä¸‰æ–¹å·¥å…· + è‡ªå®šä¹‰å·¥å…·
2. **è¿ç§»ç­–ç•¥**ï¼šæ¸è¿›å¼è¿ç§»ï¼Œåˆ†é˜¶æ®µè¿›è¡Œ
3. **è´¨é‡ä¿è¯**ï¼šè‡ªåŠ¨åŒ–æµ‹è¯• + æ‰‹åŠ¨éªŒè¯
4. **é£é™©æ§åˆ¶**ï¼šå¤‡ä»½ç­–ç•¥ + å›æ»šæ–¹æ¡ˆ

é€šè¿‡åˆç†çš„å·¥å…·ç»„åˆå’Œè¿ç§»ç­–ç•¥ï¼Œå¯ä»¥å¤§å¤§é™ä½è¿ç§»é£é™©ï¼Œæé«˜è¿ç§»æ•ˆç‡ã€‚

## React è¿ç§»å·¥å…·ç”Ÿæ€å¯¹æ¯”

### React å®˜æ–¹è¿ç§»å·¥å…·

#### 1. React Migration Scripts
**å®˜æ–¹æä¾›çš„è¿ç§»è„šæœ¬ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–è¿ç§»**

```bash
# å®‰è£…è¿ç§»å·¥å…·
npm install -g @reactjs/migration-scripts

# è¿è¡Œè¿ç§»æ£€æŸ¥
npx react-migration-scripts check

# è‡ªåŠ¨è¿ç§»
npx react-migration-scripts migrate
```

**æ”¯æŒçš„è¿ç§»ç±»å‹ï¼š**
```javascript
const reactMigrationTypes = {
  // ç±»ç»„ä»¶åˆ°å‡½æ•°ç»„ä»¶
  classToFunction: {
    description: 'å°†ç±»ç»„ä»¶è½¬æ¢ä¸ºå‡½æ•°ç»„ä»¶',
    examples: [
      'React.Component â†’ å‡½æ•°ç»„ä»¶',
      'this.state â†’ useState',
      'this.props â†’ propså‚æ•°'
    ]
  },
  
  // ç”Ÿå‘½å‘¨æœŸé’©å­è¿ç§»
  lifecycle: {
    description: 'ç”Ÿå‘½å‘¨æœŸé’©å­è¿ç§»',
    mappings: {
      'componentDidMount': 'useEffect(() => {}, [])',
      'componentDidUpdate': 'useEffect(() => {}, [deps])',
      'componentWillUnmount': 'useEffect(() => { return cleanup }, [])'
    }
  },
  
  // Context APIè¿ç§»
  context: {
    description: 'Context APIä½¿ç”¨æ–¹å¼è¿ç§»',
    changes: [
      'React.createContext() è¯­æ³•æ›´æ–°',
      'Consumerç»„ä»¶ â†’ useContext Hook',
      'Providerä½¿ç”¨æ–¹å¼ä¼˜åŒ–'
    ]
  }
}
```

#### 2. React Codemods
**åŸºäºASTçš„ä»£ç è½¬æ¢å·¥å…·**

```bash
# å®‰è£…jscodeshift
npm install -g jscodeshift

# è¿è¡ŒReact codemods
jscodeshift -t react-codemod/transforms/class.js src/
jscodeshift -t react-codemod/transforms/rename-unsafe-lifecycles.js src/
jscodeshift -t react-codemod/transforms/sort-comp.js src/
```

**å¸¸ç”¨codemodè½¬æ¢ï¼š**
```javascript
// è½¬æ¢å‰ (ç±»ç»„ä»¶)
class MyComponent extends React.Component {
  constructor(props) {
    super(props)
    this.state = { count: 0 }
  }
  
  componentDidMount() {
    console.log('Component mounted')
  }
  
  handleClick = () => {
    this.setState({ count: this.state.count + 1 })
  }
  
  render() {
    return (
      <div onClick={this.handleClick}>
        Count: {this.state.count}
      </div>
    )
  }
}

// è½¬æ¢å (å‡½æ•°ç»„ä»¶)
import React, { useState, useEffect } from 'react'

function MyComponent() {
  const [count, setCount] = useState(0)
  
  useEffect(() => {
    console.log('Component mounted')
  }, [])
  
  const handleClick = () => {
    setCount(count + 1)
  }
  
  return (
    <div onClick={handleClick}>
      Count: {count}
    </div>
  )
}
```

### ç¬¬ä¸‰æ–¹Reactè¿ç§»å·¥å…·

#### 1. react-migration-helper
**æ™ºèƒ½Reactè¿ç§»åŠ©æ‰‹**

```bash
# å®‰è£…å·¥å…·
npm install -g react-migration-helper

# åˆ†æé¡¹ç›®
react-migration-helper analyze ./src

# ç”Ÿæˆè¿ç§»æŠ¥å‘Š
react-migration-helper report

# è‡ªåŠ¨è¿ç§»
react-migration-helper migrate --auto-fix
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
```javascript
const reactMigrationFeatures = {
  // æ™ºèƒ½æ£€æµ‹
  detection: [
    'ç±»ç»„ä»¶è¯†åˆ«',
    'ç”Ÿå‘½å‘¨æœŸé’©å­æ£€æµ‹',
    'Contextä½¿ç”¨åˆ†æ',
    'Refä½¿ç”¨æ¨¡å¼è¯†åˆ«'
  ],
  
  // è‡ªåŠ¨è½¬æ¢
  transformation: [
    'ç±»ç»„ä»¶ â†’ å‡½æ•°ç»„ä»¶',
    'this.state â†’ useState',
    'this.props â†’ props',
    'ç”Ÿå‘½å‘¨æœŸ â†’ Hooks',
    'Context.Consumer â†’ useContext'
  ],
  
  // ä»£ç ä¼˜åŒ–
  optimization: [
    'æ€§èƒ½ä¼˜åŒ–å»ºè®®',
    'æœ€ä½³å®è·µæ¨è',
    'TypeScriptç±»å‹æ¨æ–­',
    'ESLintè§„åˆ™æ›´æ–°'
  ]
}
```

#### 2. react-hooks-migrator
**ä¸“é—¨é’ˆå¯¹Hooksè¿ç§»çš„å·¥å…·**

```bash
# å®‰è£…Hooksè¿ç§»å·¥å…·
npm install -g react-hooks-migrator

# è¿ç§»ç”Ÿå‘½å‘¨æœŸé’©å­
react-hooks-migrator lifecycle ./src

# è¿ç§»çŠ¶æ€ç®¡ç†
react-hooks-migrator state ./src

# è¿ç§»Contextä½¿ç”¨
react-hooks-migrator context ./src
```

**Hooksè¿ç§»æ˜ å°„ï¼š**
```javascript
const hooksMigrationMap = {
  // çŠ¶æ€ç®¡ç†è¿ç§»
  state: {
    'this.state = { x: 0 }': 'const [x, setX] = useState(0)',
    'this.setState({ x: 1 })': 'setX(1)',
    'this.state.x': 'x'
  },
  
  // ç”Ÿå‘½å‘¨æœŸè¿ç§»
  lifecycle: {
    'componentDidMount()': 'useEffect(() => {}, [])',
    'componentDidUpdate(prevProps)': 'useEffect(() => {}, [deps])',
    'componentWillUnmount()': 'useEffect(() => { return cleanup }, [])'
  },
  
  // äº‹ä»¶å¤„ç†è¿ç§»
  events: {
    'this.handleClick = this.handleClick.bind(this)': 'const handleClick = () => {}',
    'onClick={this.handleClick}': 'onClick={handleClick}'
  }
}
```

### è‡ªå®šä¹‰Reactè¿ç§»å·¥å…·å¼€å‘

#### 1. Reactè¿ç§»éªŒè¯å™¨

```javascript
/* @source cursor @line_count 180 @branch master */

// react-migration-validator.js
import { parse } from '@babel/parser'
import traverse from '@babel/traverse'
import fs from 'fs'
import path from 'path'

class ReactMigrationValidator {
  constructor(options = {}) {
    this.options = {
      strict: false,
      autoFix: false,
      ...options
    }
    this.issues = []
  }

  // éªŒè¯Reactæ–‡ä»¶
  validateReactFile(filePath, content) {
    const issues = []
    
    try {
      const ast = parse(content, {
        sourceType: 'module',
        plugins: ['jsx', 'typescript', 'decorators-legacy']
      })
      
      traverse(ast, {
        // æ£€æŸ¥ç±»ç»„ä»¶
        ClassDeclaration(path) {
          const { node } = path
          
          // æ£€æŸ¥æ˜¯å¦ç»§æ‰¿React.Component
          if (node.superClass && 
              node.superClass.type === 'MemberExpression' &&
              node.superClass.object.name === 'React' &&
              node.superClass.property.name === 'Component') {
            
            issues.push({
              type: 'warning',
              message: 'æ£€æµ‹åˆ°ç±»ç»„ä»¶ï¼Œå»ºè®®è¿ç§»åˆ°å‡½æ•°ç»„ä»¶',
              line: node.loc?.start.line,
              suggestion: 'ä½¿ç”¨å‡½æ•°ç»„ä»¶å’ŒHooksæ›¿ä»£ç±»ç»„ä»¶'
            })
          }
        },
        
        // æ£€æŸ¥ç”Ÿå‘½å‘¨æœŸé’©å­
        ClassMethod(path) {
          const { node } = path
          const deprecatedLifecycles = [
            'componentWillMount',
            'componentWillReceiveProps', 
            'componentWillUpdate'
          ]
          
          if (deprecatedLifecycles.includes(node.key.name)) {
            issues.push({
              type: 'error',
              message: `ç”Ÿå‘½å‘¨æœŸé’©å­ ${node.key.name} å·²åºŸå¼ƒ`,
              line: node.loc?.start.line,
              suggestion: 'ä½¿ç”¨useEffectæ›¿ä»£'
            })
          }
        },
        
        // æ£€æŸ¥this.setStateä½¿ç”¨
        CallExpression(path) {
          const { node } = path
          
          if (node.callee.type === 'MemberExpression' &&
              node.callee.property.name === 'setState') {
            
            issues.push({
              type: 'info',
              message: 'æ£€æµ‹åˆ°setStateä½¿ç”¨',
              line: node.loc?.start.line,
              suggestion: 'è€ƒè™‘ä½¿ç”¨useState Hook'
            })
          }
        },
        
        // æ£€æŸ¥Context.Consumerä½¿ç”¨
        JSXElement(path) {
          const { node } = path
          
          if (node.openingElement.name.name === 'Context.Consumer') {
            issues.push({
              type: 'info',
              message: 'æ£€æµ‹åˆ°Context.Consumerä½¿ç”¨',
              line: node.loc?.start.line,
              suggestion: 'è€ƒè™‘ä½¿ç”¨useContext Hook'
            })
          }
        }
      })
      
    } catch (error) {
      issues.push({
        type: 'error',
        message: `è§£æé”™è¯¯: ${error.message}`,
        line: error.line
      })
    }
    
    return issues
  }

  // ç”Ÿæˆè¿ç§»æŠ¥å‘Š
  generateReport() {
    const report = {
      summary: {
        total: this.issues.length,
        errors: this.issues.filter(i => i.type === 'error').length,
        warnings: this.issues.filter(i => i.type === 'warning').length,
        info: this.issues.filter(i => i.type === 'info').length
      },
      issues: this.issues,
      recommendations: this.generateRecommendations()
    }
    
    return report
  }

  // ç”Ÿæˆè¿ç§»å»ºè®®
  generateRecommendations() {
    const recommendations = []
    
    const classComponents = this.issues.filter(i => 
      i.message.includes('ç±»ç»„ä»¶')
    ).length
    
    const deprecatedLifecycles = this.issues.filter(i => 
      i.message.includes('ç”Ÿå‘½å‘¨æœŸé’©å­')
    ).length
    
    if (classComponents > 0) {
      recommendations.push('ä¼˜å…ˆè¿ç§»ç±»ç»„ä»¶åˆ°å‡½æ•°ç»„ä»¶')
    }
    
    if (deprecatedLifecycles > 0) {
      recommendations.push('ç«‹å³ä¿®å¤åºŸå¼ƒçš„ç”Ÿå‘½å‘¨æœŸé’©å­')
    }
    
    return recommendations
  }
}

export default ReactMigrationValidator
```

#### 2. Reactä¾èµ–åˆ†æå™¨

```javascript
// react-dependency-analyzer.js
import fs from 'fs'
import path from 'path'

class ReactDependencyAnalyzer {
  constructor() {
    this.reactDependencies = new Set()
    this.legacyDependencies = new Set()
    this.migrationTargets = new Set()
  }

  // åˆ†æpackage.jsonä¾èµ–
  analyzeDependencies(packageJsonPath) {
    const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf8'))
    const allDependencies = {
      ...packageJson.dependencies,
      ...packageJson.devDependencies
    }

    const analysis = {
      reactVersion: null,
      legacyDeps: [],
      migrationTargets: [],
      recommendations: []
    }

    // æ£€æµ‹Reactç‰ˆæœ¬
    if (allDependencies.react) {
      analysis.reactVersion = allDependencies.react
      
      if (allDependencies.react.startsWith('^16.') || 
          allDependencies.react.startsWith('^17.')) {
        analysis.recommendations.push({
          type: 'version',
          message: 'å»ºè®®å‡çº§åˆ°React 18',
          current: allDependencies.react,
          target: '^18.0.0'
        })
      }
    }

    // æ£€æµ‹éœ€è¦è¿ç§»çš„ä¾èµ–
    const legacyPatterns = [
      /^react-router@^4\./,
      /^redux@^3\./,
      /^mobx@^4\./,
      /^antd@^3\./,
      /^material-ui@^3\./
    ]

    const migrationTargets = {
      'react-router': { from: '^4.x', to: '^6.x', breaking: true },
      'redux': { from: '^3.x', to: '^4.x', breaking: true },
      'mobx': { from: '^4.x', to: '^6.x', breaking: true },
      'antd': { from: '^3.x', to: '^4.x', breaking: true },
      'material-ui': { from: '^3.x', to: '@mui/material', breaking: true }
    }

    Object.entries(allDependencies).forEach(([name, version]) => {
      if (legacyPatterns.some(pattern => pattern.test(`${name}@${version}`))) {
        analysis.legacyDeps.push({ name, version })
        
        if (migrationTargets[name]) {
          analysis.migrationTargets.push({
            name,
            current: version,
            target: migrationTargets[name].to,
            breaking: migrationTargets[name].breaking
          })
        }
      }
    })

    return analysis
  }

  // æ£€æŸ¥Hookså…¼å®¹æ€§
  checkHooksCompatibility(analysis) {
    const issues = []
    
    if (analysis.reactVersion && 
        (analysis.reactVersion.startsWith('^16.') && 
         !analysis.reactVersion.includes('16.8'))) {
      issues.push({
        type: 'error',
        message: 'Reactç‰ˆæœ¬ä¸æ”¯æŒHooks',
        current: analysis.reactVersion,
        requirement: 'éœ€è¦React 16.8+æ‰èƒ½ä½¿ç”¨Hooks'
      })
    }
    
    return issues
  }
}

export default ReactDependencyAnalyzer
```

#### 3. Reactè‡ªåŠ¨è¿ç§»å™¨

```javascript
// react-auto-migrator.js
import fs from 'fs'
import path from 'path'
import { transform } from '@babel/core'
import ReactMigrationValidator from './react-migration-validator.js'

class ReactAutoMigrator {
  constructor(options = {}) {
    this.options = {
      backup: true,
      dryRun: false,
      ...options
    }
    this.validator = new ReactMigrationValidator()
    this.migrationCount = 0
  }

  // è¿ç§»Reactæ–‡ä»¶
  async migrateReactFile(filePath) {
    const content = fs.readFileSync(filePath, 'utf8')
    const originalContent = content
    
    // å¤‡ä»½åŸæ–‡ä»¶
    if (this.options.backup) {
      const backupPath = `${filePath}.backup`
      fs.writeFileSync(backupPath, content)
    }
    
    let migratedContent = content
    
    // åº”ç”¨è¿ç§»è§„åˆ™
    migratedContent = this.applyMigrationRules(migratedContent)
    
    // éªŒè¯è¿ç§»ç»“æœ
    const issues = this.validator.validateReactFile(filePath, migratedContent)
    const errors = issues.filter(i => i.type === 'error')
    
    if (errors.length > 0) {
      console.warn(`è¿ç§»æ–‡ä»¶ ${filePath} æ—¶å‘ç°é”™è¯¯:`, errors)
      return { success: false, errors }
    }
    
    // å†™å…¥è¿ç§»åçš„æ–‡ä»¶
    if (!this.options.dryRun) {
      fs.writeFileSync(filePath, migratedContent)
    }
    
    this.migrationCount++
    
    return {
      success: true,
      changes: this.detectChanges(originalContent, migratedContent)
    }
  }

  // åº”ç”¨è¿ç§»è§„åˆ™
  applyMigrationRules(content) {
    let result = content
    
    // è§„åˆ™1: ç±»ç»„ä»¶è½¬æ¢ä¸ºå‡½æ•°ç»„ä»¶
    result = this.convertClassToFunction(result)
    
    // è§„åˆ™2: ç”Ÿå‘½å‘¨æœŸé’©å­è¿ç§»
    result = this.migrateLifecycleHooks(result)
    
    // è§„åˆ™3: çŠ¶æ€ç®¡ç†è¿ç§»
    result = this.migrateStateManagement(result)
    
    // è§„åˆ™4: Contextä½¿ç”¨è¿ç§»
    result = this.migrateContextUsage(result)
    
    return result
  }

  // ç±»ç»„ä»¶è½¬æ¢ä¸ºå‡½æ•°ç»„ä»¶
  convertClassToFunction(content) {
    // ç®€å•çš„ç±»ç»„ä»¶è½¬æ¢ç¤ºä¾‹
    const classComponentRegex = /class\s+(\w+)\s+extends\s+React\.Component\s*{([^}]+)}/g
    
    return content.replace(classComponentRegex, (match, className, classBody) => {
      // æå–constructor
      const constructorMatch = classBody.match(/constructor\s*\([^)]*\)\s*{([^}]+)}/)
      const stateMatch = constructorMatch ? 
        constructorMatch[1].match(/this\.state\s*=\s*({[^}]+})/) : null
      
      // æå–renderæ–¹æ³•
      const renderMatch = classBody.match(/render\s*\(\)\s*{([^}]+)}/)
      
      if (renderMatch) {
        let functionComponent = `function ${className}() {\n`
        
        // æ·»åŠ çŠ¶æ€
        if (stateMatch) {
          functionComponent += `  const [state, setState] = useState(${stateMatch[1]})\n`
        }
        
        functionComponent += `  \n  return (\n    ${renderMatch[1].trim()}\n  )\n}`
        
        return functionComponent
      }
      
      return match
    })
  }

  // è¿ç§»ç”Ÿå‘½å‘¨æœŸé’©å­
  migrateLifecycleHooks(content) {
    const lifecycleMigrations = [
      { from: 'componentDidMount', to: 'useEffect(() => {}, [])' },
      { from: 'componentWillUnmount', to: 'useEffect(() => { return cleanup }, [])' }
    ]
    
    lifecycleMigrations.forEach(migration => {
      const regex = new RegExp(`\\b${migration.from}\\b`, 'g')
      content = content.replace(regex, migration.to)
    })
    
    return content
  }

  // è¿ç§»çŠ¶æ€ç®¡ç†
  migrateStateManagement(content) {
    // æ›¿æ¢this.stateè®¿é—®
    content = content.replace(/this\.state\.(\w+)/g, '$1')
    
    // æ›¿æ¢this.setState
    content = content.replace(/this\.setState\s*\(\s*{([^}]+)}\s*\)/g, 
      (match, stateUpdates) => {
        const updates = stateUpdates.split(',').map(update => {
          const [key, value] = update.split(':').map(s => s.trim())
          return `set${key.charAt(0).toUpperCase() + key.slice(1)}(${value})`
        })
        return updates.join('\n    ')
      })
    
    return content
  }

  // è¿ç§»Contextä½¿ç”¨
  migrateContextUsage(content) {
    // æ›¿æ¢Context.Consumerä¸ºuseContext
    const consumerRegex = /<(\w+)\.Consumer>\s*{([^}]+)}\s*<\/\1\.Consumer>/g
    
    return content.replace(consumerRegex, (match, contextName, consumerBody) => {
      return `{(() => {
  const context = useContext(${contextName})
  return ${consumerBody.trim()}
})()}`
    })
  }

  // æ‰¹é‡è¿ç§»
  async migrateDirectory(dirPath) {
    const files = this.findReactFiles(dirPath)
    const results = []
    
    for (const file of files) {
      try {
        const result = await this.migrateReactFile(file)
        results.push({ file, ...result })
      } catch (error) {
        results.push({ file, success: false, error: error.message })
      }
    }
    
    return results
  }

  // æŸ¥æ‰¾Reactæ–‡ä»¶
  findReactFiles(dirPath) {
    const files = []
    
    const walk = (currentPath) => {
      const items = fs.readdirSync(currentPath)
      
      items.forEach(item => {
        const fullPath = path.join(currentPath, item)
        const stat = fs.statSync(fullPath)
        
        if (stat.isDirectory()) {
          walk(fullPath)
        } else if (item.endsWith('.jsx') || item.endsWith('.tsx') || 
                   (item.endsWith('.js') && fs.readFileSync(fullPath, 'utf8').includes('React'))) {
          files.push(fullPath)
        }
      })
    }
    
    walk(dirPath)
    return files
  }
}

export default ReactAutoMigrator
```

### React vs Vue è¿ç§»å·¥å…·å¯¹æ¯”

#### 1. è¿ç§»å¤æ‚åº¦å¯¹æ¯”

| æ–¹é¢ | React | Vue |
|------|-------|-----|
| **è¯­æ³•å˜åŒ–** | ä¸­ç­‰ (ç±»ç»„ä»¶â†’å‡½æ•°ç»„ä»¶) | è¾ƒå¤§ (Options APIâ†’Composition API) |
| **çŠ¶æ€ç®¡ç†** | ç®€å• (this.stateâ†’useState) | ä¸­ç­‰ (dataâ†’ref/reactive) |
| **ç”Ÿå‘½å‘¨æœŸ** | ä¸­ç­‰ (ç”Ÿå‘½å‘¨æœŸâ†’useEffect) | ç®€å• (ç”Ÿå‘½å‘¨æœŸåç§°å˜åŒ–) |
| **å…¨å±€API** | æ— é‡å¤§å˜åŒ– | é‡å¤§å˜åŒ– (Vue.useâ†’app.use) |
| **äº‹ä»¶ç³»ç»Ÿ** | æ— å˜åŒ– | é‡å¤§å˜åŒ– ($on/$offç§»é™¤) |

#### 2. å·¥å…·ç”Ÿæ€å¯¹æ¯”

```javascript
const toolEcosystemComparison = {
  react: {
    official: [
      'React Migration Scripts',
      'React Codemods',
      'Create React Appè¿ç§»æŒ‡å—'
    ],
    thirdParty: [
      'react-migration-helper',
      'react-hooks-migrator',
      'jscodeshift'
    ],
    customTools: [
      'ASTè§£æå™¨',
      'ä»£ç è½¬æ¢å™¨',
      'ä¾èµ–åˆ†æå™¨'
    ]
  },
  
  vue: {
    official: [
      'Vue Migration Build',
      '@vue/compat',
      'Vue 3è¿ç§»æŒ‡å—'
    ],
    thirdParty: [
      'vue-migration-helper',
      'vue-codemod',
      'Vue CLIè¿ç§»å·¥å…·'
    ],
    customTools: [
      'Vueç¼–è¯‘å™¨SFC',
      'æ¨¡æ¿è§£æå™¨',
      'ä¾èµ–åˆ†æå™¨'
    ]
  }
}
```

#### 3. è¿ç§»ç­–ç•¥å¯¹æ¯”

```javascript
const migrationStrategyComparison = {
  react: {
    approach: 'æ¸è¿›å¼è¿ç§»',
    phases: [
      'å‡çº§Reactç‰ˆæœ¬åˆ°16.8+',
      'é€æ­¥è¿ç§»ç±»ç»„ä»¶',
      'å¼•å…¥Hooks',
      'ä¼˜åŒ–æ€§èƒ½'
    ],
    risk: 'ä½åˆ°ä¸­ç­‰',
    timeline: '2-4å‘¨'
  },
  
  vue: {
    approach: 'å…¼å®¹æ€§æ„å»º',
    phases: [
      'ä½¿ç”¨Vue 3å…¼å®¹æ€§æ„å»º',
      'ä¿®å¤å…¼å®¹æ€§è­¦å‘Š',
      'è¿ç§»åˆ°Vue 3 API',
      'é‡‡ç”¨æ–°ç‰¹æ€§'
    ],
    risk: 'ä¸­ç­‰',
    timeline: '4-8å‘¨'
  }
}
```

### æ€»ç»“

Reactå’ŒVueéƒ½æœ‰å®Œå–„çš„è¿ç§»å·¥å…·ç”Ÿæ€ï¼š

#### **Reactè¿ç§»å·¥å…·ç‰¹ç‚¹ï¼š**
1. **å®˜æ–¹æ”¯æŒå¼º**ï¼šReactå›¢é˜Ÿæä¾›å®Œå–„çš„è¿ç§»æŒ‡å—å’Œå·¥å…·
2. **æ¸è¿›å¼è¿ç§»**ï¼šå¯ä»¥é€æ­¥è¿ç§»ï¼Œé£é™©ç›¸å¯¹è¾ƒä½
3. **Hooksç”Ÿæ€**ï¼šä¸°å¯Œçš„Hooksè¿ç§»å·¥å…·å’Œæœ€ä½³å®è·µ
4. **ç¤¾åŒºæ´»è·ƒ**ï¼šå¤§é‡ç¬¬ä¸‰æ–¹è¿ç§»å·¥å…·å’Œæ’ä»¶

#### **Vueè¿ç§»å·¥å…·ç‰¹ç‚¹ï¼š**
1. **å…¼å®¹æ€§æ„å»º**ï¼šå®˜æ–¹æä¾›å…¼å®¹æ€§æ„å»ºï¼Œé™ä½è¿ç§»é£é™©
2. **è¯­æ³•å˜åŒ–å¤§**ï¼šéœ€è¦æ›´å¤šçš„ä»£ç è½¬æ¢å·¥ä½œ
3. **ç”Ÿæ€ç³»ç»Ÿè¿ç§»**ï¼šéœ€è¦åŒæ—¶è¿ç§»ç›¸å…³ä¾èµ–åº“
4. **å·¥å…·é“¾å®Œå–„**ï¼šVueç¼–è¯‘å™¨æä¾›å¼ºå¤§çš„ä»£ç åˆ†æèƒ½åŠ›

#### **é€‰æ‹©å»ºè®®ï¼š**
- **Reacté¡¹ç›®**ï¼šä¼˜å…ˆä½¿ç”¨å®˜æ–¹codemods + ç¬¬ä¸‰æ–¹å·¥å…·
- **Vueé¡¹ç›®**ï¼šä½¿ç”¨å…¼å®¹æ€§æ„å»º + è‡ªå®šä¹‰è¿ç§»å·¥å…·
- **å¤§å‹é¡¹ç›®**ï¼šéƒ½éœ€è¦åˆ¶å®šè¯¦ç»†çš„è¿ç§»è®¡åˆ’å’Œå›æ»šç­–ç•¥

ä¸¤ç§æ¡†æ¶çš„è¿ç§»å·¥å…·éƒ½åœ¨ä¸æ–­å‘å±•ï¼Œä¸ºå¼€å‘è€…æä¾›äº†è¶Šæ¥è¶Šå¥½çš„è¿ç§»ä½“éªŒã€‚

